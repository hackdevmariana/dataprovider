<?php

namespace Database\Seeders;

use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use App\Models\PlantSpecies;
use App\Models\Region;
use Illuminate\Support\Str;

class PlantSpeciesSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        $this->command->info('ğŸŒ± Sembrando especies vegetales autÃ³ctonas espaÃ±olas...');

        // Obtener regiones disponibles para asignar especies nativas
        $regions = Region::take(10)->get();
        $defaultRegion = $regions->first();

        $plantSpecies = [
            // ===== ÃRBOLES AUTÃ“CTONOS =====
            [
                'name' => 'Encina',
                'scientific_name' => 'Quercus ilex',
                'family' => 'Fagaceae',
                'co2_absorption_kg_per_year' => 22.5,
                'plant_type' => 'tree',
                'size_category' => 'large',
                'height_min' => 8.0,
                'height_max' => 25.0,
                'lifespan_years' => 800,
                'growth_rate_cm_year' => 25,
                'climate_zones' => ['mediterrÃ¡neo', 'continental'],
                'soil_types' => 'Suelos calcÃ¡reos, arcillosos, bien drenados',
                'water_needs_mm_year' => 450.0,
                'drought_resistant' => true,
                'frost_resistant' => true,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => true,
                'suitable_for_urban' => true,
                'flowering_season' => 'Primavera',
                'fruit_season' => 'OtoÃ±o',
                'provides_food' => true,
                'provides_timber' => true,
                'medicinal_use' => false,
                'planting_cost_eur' => 8.50,
                'maintenance_cost_eur_year' => 1.20,
                'survival_rate_percent' => 90,
                'description' => 'Ãrbol emblemÃ¡tico de la penÃ­nsula ibÃ©rica, muy resistente a la sequÃ­a y adaptado al clima mediterrÃ¡neo. Sus bellotas son alimento fundamental para la fauna silvestre.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],
            [
                'name' => 'Roble comÃºn',
                'scientific_name' => 'Quercus robur',
                'family' => 'Fagaceae',
                'co2_absorption_kg_per_year' => 28.0,
                'plant_type' => 'tree',
                'size_category' => 'giant',
                'height_min' => 15.0,
                'height_max' => 40.0,
                'lifespan_years' => 1000,
                'growth_rate_cm_year' => 30,
                'climate_zones' => ['atlÃ¡ntico', 'continental'],
                'soil_types' => 'Suelos profundos, hÃºmedos, ricos en materia orgÃ¡nica',
                'water_needs_mm_year' => 800.0,
                'drought_resistant' => false,
                'frost_resistant' => true,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => true,
                'suitable_for_urban' => true,
                'flowering_season' => 'Primavera',
                'fruit_season' => 'OtoÃ±o',
                'provides_food' => true,
                'provides_timber' => true,
                'medicinal_use' => false,
                'planting_cost_eur' => 12.00,
                'maintenance_cost_eur_year' => 1.80,
                'survival_rate_percent' => 85,
                'description' => 'Roble majestuoso de las zonas hÃºmedas del norte de EspaÃ±a, muy valorado por su madera noble y su longevidad excepcional.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],
            [
                'name' => 'Pino marÃ­timo',
                'scientific_name' => 'Pinus pinaster',
                'family' => 'Pinaceae',
                'co2_absorption_kg_per_year' => 30.0,
                'plant_type' => 'conifer',
                'size_category' => 'large',
                'height_min' => 20.0,
                'height_max' => 35.0,
                'lifespan_years' => 300,
                'growth_rate_cm_year' => 40,
                'climate_zones' => ['mediterrÃ¡neo', 'atlÃ¡ntico'],
                'soil_types' => 'Suelos arenosos, Ã¡cidos, bien drenados',
                'water_needs_mm_year' => 600.0,
                'drought_resistant' => true,
                'frost_resistant' => true,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => true,
                'suitable_for_urban' => true,
                'flowering_season' => 'Primavera',
                'fruit_season' => 'OtoÃ±o-Invierno',
                'provides_food' => false,
                'provides_timber' => true,
                'medicinal_use' => true,
                'planting_cost_eur' => 6.00,
                'maintenance_cost_eur_year' => 0.80,
                'survival_rate_percent' => 95,
                'description' => 'Pino autÃ³ctono muy resistente, ideal para reforestaciÃ³n en suelos pobres. Su resina tiene propiedades medicinales.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],
            [
                'name' => 'Olivo',
                'scientific_name' => 'Olea europaea',
                'family' => 'Oleaceae',
                'co2_absorption_kg_per_year' => 12.0,
                'plant_type' => 'tree',
                'size_category' => 'medium',
                'height_min' => 4.0,
                'height_max' => 12.0,
                'lifespan_years' => 2000,
                'growth_rate_cm_year' => 15,
                'climate_zones' => ['mediterrÃ¡neo'],
                'soil_types' => 'Suelos calcÃ¡reos, arcillosos, bien drenados',
                'water_needs_mm_year' => 300.0,
                'drought_resistant' => true,
                'frost_resistant' => false,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => false,
                'suitable_for_urban' => true,
                'flowering_season' => 'Primavera',
                'fruit_season' => 'OtoÃ±o',
                'provides_food' => true,
                'provides_timber' => false,
                'medicinal_use' => true,
                'planting_cost_eur' => 25.00,
                'maintenance_cost_eur_year' => 3.50,
                'survival_rate_percent' => 98,
                'description' => 'Ãrbol milenario sÃ­mbolo de la cultura mediterrÃ¡nea, muy resistente a la sequÃ­a y de gran valor econÃ³mico y cultural.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],
            [
                'name' => 'Alcornoque',
                'scientific_name' => 'Quercus suber',
                'family' => 'Fagaceae',
                'co2_absorption_kg_per_year' => 18.5,
                'plant_type' => 'tree',
                'size_category' => 'large',
                'height_min' => 10.0,
                'height_max' => 20.0,
                'lifespan_years' => 500,
                'growth_rate_cm_year' => 20,
                'climate_zones' => ['mediterrÃ¡neo'],
                'soil_types' => 'Suelos Ã¡cidos, arenosos, bien drenados',
                'water_needs_mm_year' => 500.0,
                'drought_resistant' => true,
                'frost_resistant' => false,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => true,
                'suitable_for_urban' => true,
                'flowering_season' => 'Primavera',
                'fruit_season' => 'OtoÃ±o',
                'provides_food' => true,
                'provides_timber' => false,
                'medicinal_use' => false,
                'planting_cost_eur' => 15.00,
                'maintenance_cost_eur_year' => 2.00,
                'survival_rate_percent' => 88,
                'description' => 'Ãrbol emblemÃ¡tico del suroeste peninsular, productor de corcho y bellotas dulces para la ganaderÃ­a.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],
            [
                'name' => 'Haya',
                'scientific_name' => 'Fagus sylvatica',
                'family' => 'Fagaceae',
                'co2_absorption_kg_per_year' => 32.0,
                'plant_type' => 'tree',
                'size_category' => 'giant',
                'height_min' => 20.0,
                'height_max' => 45.0,
                'lifespan_years' => 400,
                'growth_rate_cm_year' => 35,
                'climate_zones' => ['atlÃ¡ntico', 'continental'],
                'soil_types' => 'Suelos frescos, hÃºmedos, ricos en materia orgÃ¡nica',
                'water_needs_mm_year' => 1000.0,
                'drought_resistant' => false,
                'frost_resistant' => true,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => true,
                'suitable_for_urban' => true,
                'flowering_season' => 'Primavera',
                'fruit_season' => 'OtoÃ±o',
                'provides_food' => true,
                'provides_timber' => true,
                'medicinal_use' => false,
                'planting_cost_eur' => 18.00,
                'maintenance_cost_eur_year' => 2.50,
                'survival_rate_percent' => 80,
                'description' => 'Ãrbol majestuoso de los bosques hÃºmedos del norte, muy valorado por su madera y su belleza paisajÃ­stica.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],

            // ===== ARBUSTOS AUTÃ“CTONOS =====
            [
                'name' => 'Romero',
                'scientific_name' => 'Rosmarinus officinalis',
                'family' => 'Lamiaceae',
                'co2_absorption_kg_per_year' => 3.5,
                'plant_type' => 'shrub',
                'size_category' => 'small',
                'height_min' => 0.5,
                'height_max' => 2.0,
                'lifespan_years' => 30,
                'growth_rate_cm_year' => 15,
                'climate_zones' => ['mediterrÃ¡neo'],
                'soil_types' => 'Suelos calcÃ¡reos, pedregosos, bien drenados',
                'water_needs_mm_year' => 200.0,
                'drought_resistant' => true,
                'frost_resistant' => false,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => false,
                'suitable_for_urban' => true,
                'flowering_season' => 'Todo el aÃ±o',
                'fruit_season' => 'Verano',
                'provides_food' => true,
                'provides_timber' => false,
                'medicinal_use' => true,
                'planting_cost_eur' => 2.50,
                'maintenance_cost_eur_year' => 0.50,
                'survival_rate_percent' => 95,
                'description' => 'Arbusto aromÃ¡tico muy resistente a la sequÃ­a, de gran valor medicinal y culinario.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],
            [
                'name' => 'Lavanda',
                'scientific_name' => 'Lavandula angustifolia',
                'family' => 'Lamiaceae',
                'co2_absorption_kg_per_year' => 2.8,
                'plant_type' => 'shrub',
                'size_category' => 'small',
                'height_min' => 0.3,
                'height_max' => 1.0,
                'lifespan_years' => 15,
                'growth_rate_cm_year' => 10,
                'climate_zones' => ['mediterrÃ¡neo'],
                'soil_types' => 'Suelos calcÃ¡reos, pedregosos, bien drenados',
                'water_needs_mm_year' => 150.0,
                'drought_resistant' => true,
                'frost_resistant' => true,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => false,
                'suitable_for_urban' => true,
                'flowering_season' => 'Verano',
                'fruit_season' => 'OtoÃ±o',
                'provides_food' => false,
                'provides_timber' => false,
                'medicinal_use' => true,
                'planting_cost_eur' => 3.00,
                'maintenance_cost_eur_year' => 0.80,
                'survival_rate_percent' => 90,
                'description' => 'Planta aromÃ¡tica muy apreciada por sus propiedades medicinales y su belleza ornamental.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],
            [
                'name' => 'Jara',
                'scientific_name' => 'Cistus ladanifer',
                'family' => 'Cistaceae',
                'co2_absorption_kg_per_year' => 4.2,
                'plant_type' => 'shrub',
                'size_category' => 'medium',
                'height_min' => 1.0,
                'height_max' => 3.0,
                'lifespan_years' => 25,
                'growth_rate_cm_year' => 20,
                'climate_zones' => ['mediterrÃ¡neo'],
                'soil_types' => 'Suelos Ã¡cidos, pedregosos, pobres',
                'water_needs_mm_year' => 180.0,
                'drought_resistant' => true,
                'frost_resistant' => false,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => true,
                'suitable_for_urban' => false,
                'flowering_season' => 'Primavera',
                'fruit_season' => 'Verano',
                'provides_food' => false,
                'provides_timber' => false,
                'medicinal_use' => true,
                'planting_cost_eur' => 1.50,
                'maintenance_cost_eur_year' => 0.30,
                'survival_rate_percent' => 92,
                'description' => 'Arbusto pionero muy resistente, ideal para la recuperaciÃ³n de suelos degradados.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],
            [
                'name' => 'Brezo',
                'scientific_name' => 'Calluna vulgaris',
                'family' => 'Ericaceae',
                'co2_absorption_kg_per_year' => 1.8,
                'plant_type' => 'shrub',
                'size_category' => 'small',
                'height_min' => 0.2,
                'height_max' => 0.8,
                'lifespan_years' => 20,
                'growth_rate_cm_year' => 8,
                'climate_zones' => ['atlÃ¡ntico', 'continental'],
                'soil_types' => 'Suelos Ã¡cidos, pobres, hÃºmedos',
                'water_needs_mm_year' => 400.0,
                'drought_resistant' => false,
                'frost_resistant' => true,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => false,
                'suitable_for_urban' => true,
                'flowering_season' => 'Verano-OtoÃ±o',
                'fruit_season' => 'OtoÃ±o',
                'provides_food' => false,
                'provides_timber' => false,
                'medicinal_use' => true,
                'planting_cost_eur' => 1.00,
                'maintenance_cost_eur_year' => 0.20,
                'survival_rate_percent' => 88,
                'description' => 'Planta caracterÃ­stica de los brezales atlÃ¡nticos, muy resistente al frÃ­o y la humedad.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],

            // ===== HIERBAS Y GRAMÃNEAS =====
            [
                'name' => 'Tomillo',
                'scientific_name' => 'Thymus vulgaris',
                'family' => 'Lamiaceae',
                'co2_absorption_kg_per_year' => 1.2,
                'plant_type' => 'herb',
                'size_category' => 'small',
                'height_min' => 0.1,
                'height_max' => 0.4,
                'lifespan_years' => 8,
                'growth_rate_cm_year' => 5,
                'climate_zones' => ['mediterrÃ¡neo'],
                'soil_types' => 'Suelos calcÃ¡reos, pedregosos, bien drenados',
                'water_needs_mm_year' => 100.0,
                'drought_resistant' => true,
                'frost_resistant' => false,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => false,
                'suitable_for_urban' => true,
                'flowering_season' => 'Primavera-Verano',
                'fruit_season' => 'Verano',
                'provides_food' => true,
                'provides_timber' => false,
                'medicinal_use' => true,
                'planting_cost_eur' => 1.50,
                'maintenance_cost_eur_year' => 0.40,
                'survival_rate_percent' => 85,
                'description' => 'Hierba aromÃ¡tica muy resistente a la sequÃ­a, de gran valor culinario y medicinal.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],
            [
                'name' => 'OrÃ©gano',
                'scientific_name' => 'Origanum vulgare',
                'family' => 'Lamiaceae',
                'co2_absorption_kg_per_year' => 1.5,
                'plant_type' => 'herb',
                'size_category' => 'small',
                'height_min' => 0.2,
                'height_max' => 0.6,
                'lifespan_years' => 10,
                'growth_rate_cm_year' => 8,
                'climate_zones' => ['mediterrÃ¡neo', 'continental'],
                'soil_types' => 'Suelos calcÃ¡reos, pedregosos, bien drenados',
                'water_needs_mm_year' => 120.0,
                'drought_resistant' => true,
                'frost_resistant' => true,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => false,
                'suitable_for_urban' => true,
                'flowering_season' => 'Verano',
                'fruit_season' => 'OtoÃ±o',
                'provides_food' => true,
                'provides_timber' => false,
                'medicinal_use' => true,
                'planting_cost_eur' => 1.80,
                'maintenance_cost_eur_year' => 0.50,
                'survival_rate_percent' => 90,
                'description' => 'Hierba aromÃ¡tica muy versÃ¡til, resistente y de mÃºltiples usos culinarios y medicinales.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],

            // ===== ESPECIES ESPECIALES =====
            [
                'name' => 'Tejo',
                'scientific_name' => 'Taxus baccata',
                'family' => 'Taxaceae',
                'co2_absorption_kg_per_year' => 15.0,
                'plant_type' => 'conifer',
                'size_category' => 'medium',
                'height_min' => 5.0,
                'height_max' => 15.0,
                'lifespan_years' => 2000,
                'growth_rate_cm_year' => 10,
                'climate_zones' => ['atlÃ¡ntico', 'continental'],
                'soil_types' => 'Suelos frescos, hÃºmedos, ricos en materia orgÃ¡nica',
                'water_needs_mm_year' => 600.0,
                'drought_resistant' => false,
                'frost_resistant' => true,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => true,
                'suitable_for_urban' => true,
                'flowering_season' => 'Primavera',
                'fruit_season' => 'OtoÃ±o',
                'provides_food' => false,
                'provides_timber' => true,
                'medicinal_use' => true,
                'planting_cost_eur' => 35.00,
                'maintenance_cost_eur_year' => 4.00,
                'survival_rate_percent' => 75,
                'description' => 'Ãrbol sagrado de los celtas, muy longevo y de madera muy valorada. Especie protegida en muchas regiones.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],
            [
                'name' => 'CastaÃ±o',
                'scientific_name' => 'Castanea sativa',
                'family' => 'Fagaceae',
                'co2_absorption_kg_per_year' => 25.0,
                'plant_type' => 'tree',
                'size_category' => 'large',
                'height_min' => 12.0,
                'height_max' => 30.0,
                'lifespan_years' => 600,
                'growth_rate_cm_year' => 35,
                'climate_zones' => ['atlÃ¡ntico', 'mediterrÃ¡neo'],
                'soil_types' => 'Suelos Ã¡cidos, frescos, bien drenados',
                'water_needs_mm_year' => 700.0,
                'drought_resistant' => false,
                'frost_resistant' => true,
                'is_endemic' => true,
                'is_invasive' => false,
                'suitable_for_reforestation' => true,
                'suitable_for_urban' => true,
                'flowering_season' => 'Verano',
                'fruit_season' => 'OtoÃ±o',
                'provides_food' => true,
                'provides_timber' => true,
                'medicinal_use' => false,
                'planting_cost_eur' => 20.00,
                'maintenance_cost_eur_year' => 2.80,
                'survival_rate_percent' => 85,
                'description' => 'Ãrbol muy valorado por sus frutos comestibles y su madera noble, tÃ­pico de las zonas hÃºmedas del norte.',
                'source' => 'manual',
                'is_verified' => true,
                'verification_entity' => 'MITECO',
            ],
        ];

        $createdCount = 0;
        $updatedCount = 0;

        foreach ($plantSpecies as $speciesData) {
            // Generar slug Ãºnico
            $speciesData['slug'] = Str::slug($speciesData['name']);
            
            // Calcular rangos de absorciÃ³n de CO2
            $co2Base = $speciesData['co2_absorption_kg_per_year'];
            $speciesData['co2_absorption_min'] = round($co2Base * 0.7, 1);
            $speciesData['co2_absorption_max'] = round($co2Base * 1.3, 1);
            
            // Asignar regiÃ³n nativa si estÃ¡ disponible
            if ($defaultRegion) {
                $speciesData['native_region_id'] = $defaultRegion->id;
            }

            $species = PlantSpecies::updateOrCreate(
                [
                    'slug' => $speciesData['slug'],
                ],
                $speciesData
            );

            if ($species->wasRecentlyCreated) {
                $createdCount++;
            } else {
                $updatedCount++;
            }
        }

        // Mostrar estadÃ­sticas
        $this->command->info("âœ… Especies creadas: {$createdCount}");
        $this->command->info("ğŸ”„ Especies actualizadas: {$updatedCount}");
        $this->command->info("ğŸ“Š Total de especies: " . PlantSpecies::count());

        // Mostrar resumen por tipo de planta
        $this->command->info("\nğŸ“‹ Resumen por tipo de planta:");
        $types = PlantSpecies::all()->groupBy('plant_type');
        foreach ($types as $type => $species) {
            $totalCo2 = $species->sum('co2_absorption_kg_per_year');
            $avgCost = $species->avg('planting_cost_eur');
            $this->command->info("  {$type}: {$species->count()} especies, absorciÃ³n total: {$totalCo2} kg CO2/aÃ±o, coste medio: " . number_format($avgCost, 2) . " â‚¬");
        }

        // Mostrar resumen por categorÃ­a de tamaÃ±o
        $this->command->info("\nğŸ“ Resumen por categorÃ­a de tamaÃ±o:");
        $sizes = PlantSpecies::all()->groupBy('size_category');
        foreach ($sizes as $size => $species) {
            $this->command->info("  {$size}: {$species->count()} especies");
        }

        // Mostrar algunas especies destacadas
        $this->command->info("\nğŸ”¬ Especies destacadas:");
        $highlightedSpecies = PlantSpecies::where('co2_absorption_kg_per_year', '>', 20)->take(3)->get();
        foreach ($highlightedSpecies as $species) {
            $this->command->info("  ğŸŒ³ {$species->name} ({$species->scientific_name})");
            $this->command->info("     ğŸ’š AbsorciÃ³n: {$species->co2_absorption_kg_per_year} kg CO2/aÃ±o");
            $this->command->info("     ğŸ“ TamaÃ±o: {$species->size_category} ({$species->height_min}-{$species->height_max} m)");
            $this->command->info("     ğŸ’° Coste: {$species->planting_cost_eur} â‚¬");
            $this->command->info("     ---");
        }

        $this->command->info("\nğŸ¯ Seeder de PlantSpecies completado exitosamente!");
    }
}